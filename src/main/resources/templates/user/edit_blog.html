<!DOCTYPE html>
<html lang="zh" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <title>写博客</title>
    <link th:href="@{/editor/css/style.css}" rel="stylesheet" href="../../static/editor/css/style.css" />
    <link th:href="@{/editor/css/editormd.css}" rel="stylesheet" href="../../static/editor/css/editormd.css" />

    <link th:href="@{/bootstrap/css/bootstrap.min.css}" href="../../static/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
    <link th:href="@{/bootstrap/css/dash-board.css}" href="../../static/bootstrap/css/dash-board.css" rel="stylesheet"/>
    <link th:href="@{/bootstrap/css/site-min.css}" href="../../static/bootstrap/css/site-min.css" rel="stylesheet"/>
    <script th:src="@{/bootstrap/script/jquery-3.4.1.min.js}" src="../../static/bootstrap/script/jquery-3.4.1.min.js"></script>
    <script th:src="@{/bootstrap/js/bootstrap.min.js}" src="../../static/bootstrap/js/bootstrap.min.js"></script>
    <script>
        function checkLeave(){
            event.returnValue="确定离开当前页面吗？";
        }
    </script>
</head>
<body style="padding: 0" onbeforeunload="checkLeave()">
<div style="width: 100%; height: 100%" id="top">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <span class="navbar-brand">快来写一篇博客吧！</span>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="#" onclick="contentRelease()">发布博客</a></li>
                <li><a href="#" onclick="contentSave()">保存草稿</a></li>
                <li><a href="#" onclick="returnIndex()">返回首页</a></li>
            </ul>
            <form class="navbar-form navbar-left" role="search">
                <div class="form-group">
                    <input type="text" id="title" name="title" class="form-control" placeholder="博客标题(1-100)" style="width: 700px"/><!-- 700px -->
                </div>
            </form>
        </div>
    </div>
    <div style="width: 100%; height: 100%">
        <form name="mdEditorForm" style="padding-top: 0; height: 100%">
            <div id="test-editormd" style="width: 100%; height: 100%">
                <textarea style="display:none;" name="content" id="content">[TOC]
                </textarea>
            </div>
        </form>
    </div>
</div>
<script th:src="@{/bootstrap/script/jquery-3.4.1.min.js}"
        src="../../static/bootstrap/script/jquery-3.4.1.min.js"></script>
<script th:src="@{/bootstrap/script/editormd.min.js}"
        src="../../static/bootstrap/script/editormd.min.js"></script>
<script type="text/javascript">
    var testEditor;

    //初始化Markdown编辑器
    $(function() {
        testEditor = editormd("test-editormd", {
            width   : "100%",
            height  : "100%",
            syncScrolling : "single",
            // 静态浏览的话应该是 ../../static/editor/lib/ */
            path    : "../../editor/lib/",
            imageUpload : true,
            imageFormats : ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
            imageUploadURL : "/file/fileUpload",

            // 指定需要显示的功能按钮
            toolbarIcons : function() {
                return ["undo","redo","|","bold","del","italic","quote","ucwords","uppercase","lowercase","|","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","|","link","reference-link","image","code","preformatted-text","code-block","table","datetime","emoji","html-entities","pagebreak","|","goto-line","watch","preview","fullscreen","clear","search"]
            }
        });
    });

    //发布博客
    function contentRelease(){
        var title = $("#title").val();
        var content = $("#content").val();

        $.post({
            url: "/blog/release",
            data: {"title":title, "content":content},
            success:function () {
                alert("发布成功");
            },
            error:function () {
                alert("发布失败");
            }
        });
    }

    //保存博客
    function contentSave(){
        var title = $("#title").val();
        var content = $("#content").val();

        $.post({
            url: "/blog/save",
            data: {"title":title, "content":content},
            success:function () {
                alert("保存成功");
            },
            error:function () {
                alert("请完善文章标题或内容");
            }
        });
    }

    //返回首页
    function returnIndex(){
        var se=confirm('文章未保存, 确定返回首页?');
        if (se === true)
            window.location.href="/user/center";
    }




</script>
</body>
</html>